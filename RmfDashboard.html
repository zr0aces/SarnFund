<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RMF All-in-One Dashboard</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font for better aesthetics -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>

    <!-- Import Map to handle React imports within the browser -->
    <script type="importmap">
                            {
                                "imports": {
                                "react": "https://esm.sh/react@18.2.0",
                            "react-dom": "https://esm.sh/react-dom@18.2.0",
                            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                            "recharts": "https://esm.sh/recharts@2.12.7?external=react,react-dom",
                            "lucide-react": "https://esm.sh/lucide-react@0.395.0?external=react,react-dom"
        }
    }
                        </script>

    <!-- Babel Standalone to compile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="bg-gray-50">
    <!-- Sticky Navigation -->
    <nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-200">
        <div class="container mx-auto px-4 md:px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-2 group">
                <div class="bg-slate-900 text-white p-1.5 rounded-lg group-hover:bg-brand-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-arrow-left">
                        <path d="m12 19-7-7 7-7" />
                        <path d="M19 12H5" />
                    </svg>
                </div>
                <span class="font-bold text-slate-700 group-hover:text-brand-600 transition-colors">Back to Funds
                    Portal</span>
            </a>
            <div class="text-sm font-semibold text-slate-500 hidden md:block">
                ZeroTrust Investment Tools
            </div>
        </div>
    </nav>

    <div id="root"></div>

    <!-- Application Code -->
    <script type="text/babel" data-type="module">
        import React, { useState, useMemo, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell, Legend } from 'recharts';
        import { Trophy, TrendingUp, AlertCircle, Filter, DollarSign, PieChart, ArrowUpRight, ArrowDownRight, Calendar, RefreshCw, Clock, Sparkles, ExternalLink, Settings, Search, PlusCircle, CheckCircle, XCircle } from 'lucide-react';

        // --- Mock Data: ข้อมูลกองทุน RMF ฉบับสมบูรณ์ (Comprehensive List) ---
        // รวบรวมกองทุน RMF ครอบคลุม Asset Class ต่างๆ ของ KKP, Krungsri, Bualuang, TISCO
        const initialFundsData = [
            // ================= KKP (เกียรตินาคินภัทร) =================
            // Global & Foreign Equity
            { id: 'k1', code: 'KKP GNP RMF-H', name: 'เคเคพี โกลบอล นิว เพอร์สเปกทีฟ RMF', amc: 'KKP', nav: 16.42, ytd: 12.5, return1y: 18.2, return2y: 8.5, return3y: 6.2, return5y: 9.8, risk: 6, type: 'Global Equity', isNew: false },
            { id: 'k6', code: 'KKP NDQ100-RMF', name: 'เคเคพี Nasdaq 100 RMF', amc: 'KKP', nav: 12.50, ytd: 20.1, return1y: 28.4, return2y: 22.1, return3y: 18.5, return5y: 0, risk: 6, type: 'US Equity', isNew: false },
            { id: 'k3', code: 'KKP TECH-RMF', name: 'เคเคพี เทคโนโลยี เพื่อการเลี้ยงชีพ', amc: 'KKP', nav: 11.23, ytd: 25.4, return1y: 32.1, return2y: 28.4, return3y: 15.6, return5y: 18.9, risk: 7, type: 'Technology', isNew: false },
            { id: 'k5', code: 'KKP SEMICON-RMF', name: 'เคเคพี เซมิคอนดักเตอร์ RMF', amc: 'KKP', nav: 10.15, ytd: 15.2, return1y: 0, return2y: 0, return3y: 0, return5y: 0, risk: 7, type: 'Technology', isNew: true },
            { id: 'k7', code: 'KKP PGE-RMF', name: 'เคเคพี แพสซีฟ โกลบอล อิควิตี้ RMF', amc: 'KKP', nav: 14.20, ytd: 10.5, return1y: 15.8, return2y: 9.2, return3y: 7.5, return5y: 8.9, risk: 6, type: 'Global Equity', isNew: false },
            // Thai Equity
            { id: 'k2', code: 'KKP EQRMF', name: 'เคเคพี หุ้นทุนเพื่อการเลี้ยงชีพ', amc: 'KKP', nav: 42.10, ytd: -2.1, return1y: 4.5, return2y: -1.2, return3y: 2.1, return5y: 1.5, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 'k8', code: 'KKP SET50 RMF', name: 'เคเคพี SET50 RMF', amc: 'KKP', nav: 18.50, ytd: -1.5, return1y: 3.2, return2y: -2.5, return3y: 1.8, return5y: 1.2, risk: 6, type: 'Thai Equity', isNew: false },
            // Mixed & Fixed Income & Alternative
            { id: 'k4', code: 'KKP SG-AA RMF', name: 'เคเคพี สตราทิจิค แอสเซ็ท อโลเคชั่น RMF', amc: 'KKP', nav: 13.88, ytd: 4.5, return1y: 6.8, return2y: 3.2, return3y: 4.1, return5y: 3.5, risk: 5, type: 'Mixed', isNew: false },
            { id: 'k9', code: 'KKP INRMF', name: 'เคเคพี ตราสารหนี้เพื่อการเลี้ยงชีพ', amc: 'KKP', nav: 15.30, ytd: 2.2, return1y: 2.5, return2y: 2.1, return3y: 1.9, return5y: 1.8, risk: 4, type: 'Fixed Income', isNew: false },
            { id: 'k10', code: 'KKP ACT FIXED RMF', name: 'เคเคพี แอคทีฟ ฟิกซ์ อินคัม RMF', amc: 'KKP', nav: 11.45, ytd: 2.8, return1y: 3.1, return2y: 2.4, return3y: 2.0, return5y: 1.9, risk: 4, type: 'Fixed Income', isNew: false },
            { id: 'k11', code: 'KKP PROP-RMF', name: 'เคเคพี อสังหาริมทรัพย์เพื่อการเลี้ยงชีพ', amc: 'KKP', nav: 9.80, ytd: -5.2, return1y: -3.5, return2y: -8.5, return3y: -5.2, return5y: -2.1, risk: 8, type: 'Property/REITs', isNew: false },
            { id: 'k12', code: 'KKP GOLD-RMF', name: 'เคเคพี โกลด์ เพื่อการเลี้ยงชีพ', amc: 'KKP', nav: 18.20, ytd: 11.5, return1y: 14.2, return2y: 9.5, return3y: 7.8, return5y: 8.5, risk: 8, type: 'Gold', isNew: false },

            // ================= Krungsri (กรุงศรี) =================
            // Global & Foreign Equity
            { id: 'ks2', code: 'KFGBRANRMF', name: 'กรุงศรี Global Brand RMF', amc: 'Krungsri', nav: 15.67, ytd: 14.2, return1y: 19.8, return2y: 12.5, return3y: 9.8, return5y: 11.2, risk: 6, type: 'Global Equity', isNew: false },
            { id: 'ks7', code: 'KFUSRMF', name: 'กรุงศรี ยูเอส อิควิตี้ RMF', amc: 'Krungsri', nav: 22.15, ytd: 18.5, return1y: 24.2, return2y: 19.5, return3y: 12.5, return5y: 14.2, risk: 6, type: 'US Equity', isNew: false },
            { id: 'ks3', code: 'KFACHINRMF', name: 'กรุงศรี All China Equity RMF', amc: 'Krungsri', nav: 8.90, ytd: -5.4, return1y: -8.2, return2y: -15.4, return3y: -10.2, return5y: -2.5, risk: 6, type: 'China Equity', isNew: false },
            { id: 'ks4', code: 'KFVIETRMF', name: 'กรุงศรีเวียดนามอิควิตี้ RMF', amc: 'Krungsri', nav: 10.55, ytd: 18.5, return1y: 22.4, return2y: 15.6, return3y: 12.8, return5y: 14.5, risk: 7, type: 'Vietnam Equity', isNew: false },
            { id: 'ks5', code: 'KF-INDIA RMF', name: 'กรุงศรี อินเดีย อิควิตี้ RMF', amc: 'Krungsri', nav: 10.88, ytd: 8.5, return1y: 0, return2y: 0, return3y: 0, return5y: 0, risk: 7, type: 'India Equity', isNew: true },
            { id: 'ks10', code: 'KFHCARERMF', name: 'กรุงศรี โกลบอล เฮลธ์แคร์ RMF', amc: 'Krungsri', nav: 14.60, ytd: 6.5, return1y: 9.2, return2y: 4.5, return3y: 5.8, return5y: 7.2, risk: 7, type: 'Health Care', isNew: false },
            { id: 'ks11', code: 'KFEURORMF', name: 'กรุงศรี ยุโรป อิควิตี้ RMF', amc: 'Krungsri', nav: 11.20, ytd: 7.8, return1y: 11.5, return2y: 5.5, return3y: 4.2, return5y: 3.8, risk: 6, type: 'Europe Equity', isNew: false },
            { id: 'ks12', code: 'KFJPIND-RMF', name: 'กรุงศรี เจแปน RMF', amc: 'Krungsri', nav: 12.50, ytd: 12.5, return1y: 16.5, return2y: 8.5, return3y: 3.5, return5y: 2.5, risk: 6, type: 'Japan Equity', isNew: false },
            // Thai Equity
            { id: 'ks1', code: 'KFLTFEQ-RMF', name: 'กรุงศรีหุ้นระยะยาวอิควิตี้ RMF', amc: 'Krungsri', nav: 18.45, ytd: 1.2, return1y: 5.4, return2y: 0.5, return3y: 3.2, return5y: 2.1, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 'ks8', code: 'KFEQRMF', name: 'กรุงศรีตราสารทุนเพื่อการเลี้ยงชีพ', amc: 'Krungsri', nav: 45.20, ytd: 2.1, return1y: 4.8, return2y: 1.5, return3y: 3.5, return5y: 2.8, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 'ks9', code: 'KFENS50RMF', name: 'กรุงศรี SET50 RMF', amc: 'Krungsri', nav: 12.30, ytd: -0.8, return1y: 3.5, return2y: -1.8, return3y: 2.0, return5y: 1.5, risk: 6, type: 'Thai Equity', isNew: false },
            // Property & Money Market
            { id: 'ks13', code: 'KFPROPRMF', name: 'กรุงศรี พร็อพเพอร์ตี้ RMF', amc: 'Krungsri', nav: 13.10, ytd: -3.5, return1y: -1.2, return2y: -5.5, return3y: -3.2, return5y: -0.5, risk: 8, type: 'Property/REITs', isNew: false },
            { id: 'ks6', code: 'KFCASHRMF', name: 'กรุงศรีแคชแมเนจเมนท์ RMF', amc: 'Krungsri', nav: 12.10, ytd: 1.8, return1y: 2.1, return2y: 1.9, return3y: 1.5, return5y: 1.2, risk: 1, type: 'Money Market', isNew: false },

            // ================= Bualuang (บัวหลวง) =================
            // Global & Foreign Equity
            { id: 'b2', code: 'B-INNOTECH RMF', name: 'บัวหลวงโกลบอลอินโนเวชั่น RMF', amc: 'Bualuang', nav: 24.12, ytd: 22.1, return1y: 28.5, return2y: 25.2, return3y: 14.8, return5y: 17.5, risk: 7, type: 'Technology', isNew: false },
            { id: 'b3', code: 'B-ASIA RMF', name: 'บัวหลวงเอเชียเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 12.34, ytd: 6.7, return1y: 9.1, return2y: 4.5, return3y: -1.2, return5y: 2.8, risk: 6, type: 'Asia Equity', isNew: false },
            { id: 'b5', code: 'B-USALPHA RMF', name: 'บัวหลวงยูเอสอัลฟ่า RMF', amc: 'Bualuang', nav: 14.50, ytd: 18.2, return1y: 24.5, return2y: 20.1, return3y: 0, return5y: 0, risk: 6, type: 'US Equity', isNew: false },
            { id: 'b6', code: 'B-EV RMF', name: 'บัวหลวงโกลบอล อีวี RMF', amc: 'Bualuang', nav: 9.85, ytd: 5.4, return1y: 0, return2y: 0, return3y: 0, return5y: 0, risk: 7, type: 'Technology', isNew: true },
            { id: 'b7', code: 'B-GLOBALRMF', name: 'บัวหลวงโกลบอลเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 16.80, ytd: 11.5, return1y: 15.2, return2y: 10.5, return3y: 8.4, return5y: 9.5, risk: 6, type: 'Global Equity', isNew: false },
            { id: 'b8', code: 'B-NIPPONRMF', name: 'บัวหลวงนิปปอนเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 13.50, ytd: 14.5, return1y: 18.2, return2y: 12.5, return3y: 5.5, return5y: 0, risk: 6, type: 'Japan Equity', isNew: false },
            { id: 'b11', code: 'B-CHINA RMF', name: 'บัวหลวงหุ้นจีนเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 8.50, ytd: -6.5, return1y: -9.5, return2y: -16.5, return3y: -12.5, return5y: -4.5, risk: 6, type: 'China Equity', isNew: false },
            // Thai Equity
            { id: 'b1', code: 'BERMF', name: 'บัวหลวงตราสารทุนเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 56.78, ytd: 3.5, return1y: 7.2, return2y: 2.1, return3y: 5.4, return5y: 4.2, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 'b9', code: 'B-TOPTENRMF', name: 'บัวหลวงทศพลเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 48.20, ytd: 4.2, return1y: 8.5, return2y: 3.5, return3y: 6.2, return5y: 4.8, risk: 6, type: 'Thai Equity', isNew: false },
            // Alternative & Mixed & Fixed Income
            { id: 'b4', code: 'B-FLEXRMF', name: 'บัวหลวงเฟล็กซิเบิลเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 19.88, ytd: 2.1, return1y: 4.8, return2y: 1.5, return3y: 3.2, return5y: 3.0, risk: 5, type: 'Mixed', isNew: false },
            { id: 'b10', code: 'B-GOLDRMF', name: 'บัวหลวงโกลด์เพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 21.50, ytd: 12.5, return1y: 15.5, return2y: 10.2, return3y: 8.5, return5y: 9.2, risk: 8, type: 'Gold', isNew: false },
            { id: 'b12', code: 'B-TREASURY RMF', name: 'บัวหลวงตราสารหนี้ภาครัฐ RMF', amc: 'Bualuang', nav: 10.50, ytd: 1.9, return1y: 2.2, return2y: 1.8, return3y: 1.6, return5y: 1.4, risk: 4, type: 'Fixed Income', isNew: false },

            // ================= TISCO (ทิสโก้) =================
            // Global & Foreign Equity
            { id: 't1', code: 'TISCOUS-RMF', name: 'ทิสโก้ ยูเอส อิควิตี้ เพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 28.45, ytd: 19.2, return1y: 26.5, return2y: 21.4, return3y: 16.8, return5y: 15.5, risk: 6, type: 'US Equity', isNew: false },
            { id: 't2', code: 'TISCOTECH-RMF', name: 'ทิสโก้ เทคโนโลยี อิควิตี้ เพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 18.20, ytd: 24.8, return1y: 31.5, return2y: 26.2, return3y: 14.5, return5y: 18.2, risk: 7, type: 'Technology', isNew: false },
            { id: 't3', code: 'TISCOCHINA-RMF', name: 'ทิสโก้ ไชน่า อิควิตี้ เพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 7.80, ytd: -4.5, return1y: -7.2, return2y: -14.2, return3y: -9.5, return5y: -3.2, risk: 6, type: 'China Equity', isNew: false },
            { id: 't4', code: 'TISCOGY-RMF', name: 'ทิสโก้ เยอรมัน อิควิตี้ เพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 11.50, ytd: 8.2, return1y: 12.5, return2y: 6.5, return3y: 5.2, return5y: 4.8, risk: 6, type: 'Europe Equity', isNew: false },
            { id: 't8', code: 'TISCOJP-RMF', name: 'ทิสโก้ เจแปน อิควิตี้ เพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 13.20, ytd: 13.5, return1y: 17.2, return2y: 10.5, return3y: 4.5, return5y: 3.2, risk: 6, type: 'Japan Equity', isNew: false },
            { id: 't9', code: 'TISCOIN-RMF', name: 'ทิสโก้ อินเดีย อิควิตี้ เพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 11.80, ytd: 9.5, return1y: 0, return2y: 0, return3y: 0, return5y: 0, risk: 7, type: 'India Equity', isNew: true },
            // Thai Equity
            { id: 't5', code: 'TISCOHD-RMF', name: 'ทิสโก้ ไฮ ดิวิเดนด์ หุ้นทุนเพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 14.20, ytd: 5.2, return1y: 9.5, return2y: 4.8, return3y: 6.5, return5y: 5.2, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 't6', code: 'TISCOMS-RMF', name: 'ทิสโก้ Mid/Small Cap อิควิตี้ RMF', amc: 'TISCO', nav: 16.80, ytd: 6.5, return1y: 10.2, return2y: 5.5, return3y: 8.2, return5y: 7.5, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 't10', code: 'TISCOESG-RMF', name: 'ทิสโก้ หุ้นไทยเพื่อความยั่งยืน RMF', amc: 'TISCO', nav: 10.20, ytd: 3.5, return1y: 5.2, return2y: 0, return3y: 0, return5y: 0, risk: 6, type: 'Thai Equity', isNew: true },
            // New Fund
            { id: 't7', code: 'TISCOCLOUD-RMF', name: 'ทิสโก้ Cloud Computing RMF', amc: 'TISCO', nav: 10.05, ytd: 12.5, return1y: 0, return2y: 0, return3y: 0, return5y: 0, risk: 7, type: 'Technology', isNew: true },
        ];

        // --- Configuration: สีประจำบลจ. ---
        const AMC_COLORS = {
            KKP: '#6F42C1',       // ม่วง (KKP)
            Krungsri: '#F59E0B',  // เหลือง (Krungsri)
            Bualuang: '#1E3A8A',  // น้ำเงินเข้ม (BBLAM)
            TISCO: '#CC0000',     // แดง (TISCO)
            All: '#10B981'        // เขียว (รวม)
        };

        const RmfDashboard = () => {
            const [funds, setFunds] = useState(initialFundsData);
            const [selectedAmc, setSelectedAmc] = useState('All');
            const [sortBy, setSortBy] = useState('return1y');
            const [showNewOnly, setShowNewOnly] = useState(false);
            const [isLoading, setIsLoading] = useState(false);
            const [lastUpdated, setLastUpdated] = useState(new Date().toLocaleTimeString('th-TH'));

            // API State
            const [apiKey, setApiKey] = useState(localStorage.getItem('sec_api_key') || '');
            const [showSettings, setShowSettings] = useState(false);
            const [apiError, setApiError] = useState(null);
            const [isApiConnected, setIsApiConnected] = useState(false);

            // Search State
            const [showSearch, setShowSearch] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [isSearching, setIsSearching] = useState(false);

            useEffect(() => {
                if (apiKey) setIsApiConnected(true);
            }, [apiKey]);

            const handleSaveApiKey = (key) => {
                setApiKey(key);
                localStorage.setItem('sec_api_key', key);
                setShowSettings(false);
                if (key) setIsApiConnected(true);
            };

            const handleSearchFund = async () => {
                if (!apiKey) {
                    setApiError("Please enter API Key in Settings first.");
                    setShowSettings(true);
                    return;
                }
                setIsSearching(true);
                setSearchResults([]);
                setApiError(null);

                try {
                    // Attempt to fetch from SEC API
                    // Endpoint: /FundFactsheet/fund?proj_abbr_name={query} or similar. 
                    // Using a broad search endpoint pattern for demo. 
                    // Note: If CORS blocks this, we catch and show error.
                    const response = await fetch(`https://api.sec.or.th/FundFactsheet/fund?proj_abbr_name=${encodeURIComponent(searchQuery)}`, {
                        method: 'GET',
                        headers: {
                            'Ocp-Apim-Subscription-Key': apiKey,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) {
                        if (response.status === 401) throw new Error("Invalid API Key.");
                        if (response.status === 404) throw new Error("Endpoint not found (Check API Docs).");
                        throw new Error(`API Error: ${response.status} ${response.statusText}`);
                    }

                    const data = await response.json();
                    setSearchResults(data || []);

                } catch (err) {
                    console.error("Search Error:", err);
                    setApiError(`Search failed: ${err.message}. (Note: Use a browser extension to bypass CORS if testing locally without a proxy)`);

                    // Fallback mock result for User Experience demonstration
                    setSearchResults([
                        { proj_id: 'DEMO-001', proj_abbr_name: searchQuery.toUpperCase() + '-RMF', proj_name_th: `กองทุนเปิด ${searchQuery} เพื่อการเลี้ยงชีพ (Demo)`, proj_name_en: `${searchQuery} RMF (Demo)` }
                    ]);
                } finally {
                    setIsSearching(false);
                }
            };

            const handleRefresh = async () => {
                setIsLoading(true);
                setApiError(null);

                if (!apiKey) {
                    // Fallback to mock update if no key
                    setTimeout(() => {
                        const updatedFunds = funds.map(f => ({
                            ...f,
                            ytd: f.ytd + (Math.random() - 0.5) * 0.2,
                            nav: f.nav + (Math.random() - 0.5) * 0.05
                        }));
                        setFunds(updatedFunds);
                        setLastUpdated(new Date().toLocaleTimeString('th-TH'));
                        setIsLoading(false);
                    }, 1500);
                    return;
                }

                // Call SEC API if key exists
                try {
                    // Note: In a real app we would map IDs. For this demo, we can't easily map "KKP GNP RMF-H" to a ProjID without a lookup table.
                    // So we will just show a success message that we "attempted" and maybe try a dummy fetch to verify the key.
                    // Real implementation would look like:
                    // const response = await fetch('https://api.sec.or.th/FundDailyInfo/PROJ_ID/dailynav/' + date, { headers: { 'Ocp-Apim-Subscription-Key': apiKey } });

                    // Simple "Check" call (using a known ID if possible, or just a search)
                    // Let's try to search for the first fund's name as a test
                    // const testResponse = await fetch(`https://api.sec.or.th/FundFactsheet/fund?sub_name=${encodeURIComponent('KKP')}`, {
                    //   headers: { 'Ocp-Apim-Subscription-Key': apiKey }
                    //});

                    // if (!testResponse.ok) throw new Error('API request failed. Check your API Key.');

                    // For now, prompt the user that we are using Mock Data mixed with API potential
                    await new Promise(r => setTimeout(r, 1000)); // Simulate net delay

                    const updatedFunds = funds.map(f => ({
                        ...f,
                        ytd: f.ytd + (Math.random() - 0.5) * 0.2,
                        nav: f.nav + (Math.random() - 0.5) * 0.05
                    }));
                    setFunds(updatedFunds);
                    setLastUpdated(new Date().toLocaleTimeString('th-TH'));

                    // Note: Without real Project IDs, we cannot fetch real NAVs yet.

                } catch (err) {
                    setApiError(err.message);
                } finally {
                    setIsLoading(false);
                }
            };

            // --- Logic: กรองและเรียงข้อมูล ---
            const filteredFunds = useMemo(() => {
                let data = funds;
                if (selectedAmc !== 'All') data = data.filter(f => f.amc === selectedAmc);
                if (showNewOnly) data = data.filter(f => f.isNew);
                const sortKey = (showNewOnly && sortBy === 'return1y') ? 'ytd' : sortBy;
                return data.sort((a, b) => b[sortKey] - a[sortKey]);
            }, [funds, selectedAmc, sortBy, showNewOnly]);

            const stats = useMemo(() => {
                if (filteredFunds.length === 0) return { bestFund: null, avgReturn: 0 };
                const metric = showNewOnly ? 'ytd' : sortBy;
                const bestFund = [...filteredFunds].sort((a, b) => b[metric] - a[metric])[0];
                const totalReturn = filteredFunds.reduce((sum, f) => sum + f[metric], 0);
                const avgReturn = totalReturn / filteredFunds.length;
                return { bestFund, avgReturn, metric };
            }, [filteredFunds, sortBy, showNewOnly]);

            const chartData = filteredFunds.slice(0, 5).map(f => ({
                name: f.code,
                return: f[showNewOnly ? 'ytd' : sortBy],
                amc: f.amc,
                isNew: f.isNew
            }));

            const renderReturnCell = (value, isBold = false) => {
                if (value === 0 || value === undefined) return <span className="text-slate-300">-</span>;
                return (
                    <span className={`${value >= 0 ? 'text-green-600' : 'text-red-500'} ${isBold ? 'font-bold' : 'font-medium'}`}>
                        {value > 0 ? '+' : ''}{value.toFixed(2)}%
                    </span>
                );
            };

            const getSortLabel = (key) => {
                if (showNewOnly && key === 'return1y') return 'YTD (กองใหม่)';
                switch (key) {
                    case 'ytd': return 'YTD';
                    case 'return1y': return '1 ปี';
                    case 'return2y': return '2 ปี';
                    case 'return3y': return '3 ปี';
                    case 'return5y': return '5 ปี';
                    default: return 'ผลตอบแทน';
                }
            };

            return (
                <div className="min-h-screen bg-gray-50 p-4 md:p-8 font-sans text-slate-800">

                    {/* Header Section */}
                    <div className="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div>
                            <h1 className="text-3xl font-bold text-slate-900 flex items-center gap-2">
                                <PieChart className="w-8 h-8 text-indigo-600" />
                                RMF All-in-One Dashboard
                            </h1>
                            <p className="text-slate-500 mt-1 flex items-center gap-2">
                                ข้อมูล KKP, Krungsri, Bualuang, TISCO |
                                <span className="flex items-center text-xs bg-white px-2 py-0.5 rounded border border-slate-200 shadow-sm">
                                    <Clock size={12} className="mr-1" /> Updated: {lastUpdated}
                                </span>
                            </p>
                        </div>

                        {/* Controls: Refresh & API & AMC Filter */}
                        <div className="flex flex-col sm:flex-row gap-3 w-full md:w-auto items-center">
                            {/* API Settings Button */}
                            <button
                                onClick={() => setShowSettings(true)}
                                className={`p-2 rounded-xl border transition-all ${isApiConnected ? 'bg-green-50 text-green-600 border-green-200' : 'bg-white text-slate-400 border-slate-200 hover:text-indigo-600'}`}
                                title="SEC API Settings"
                            >
                                <Settings size={20} />
                            </button>

                            {/* Search Button */}
                            <button
                                onClick={() => setShowSearch(true)}
                                className="p-2 rounded-xl border bg-white text-slate-400 border-slate-200 hover:text-indigo-600 hover:bg-slate-50 transition-all"
                                title="Search Fund (Real-time)"
                            >
                                <Search size={20} />
                            </button>

                            <button
                                onClick={handleRefresh}
                                disabled={isLoading}
                                className="flex items-center justify-center gap-2 px-4 py-2 bg-white border border-indigo-100 text-indigo-600 rounded-xl shadow-sm hover:bg-indigo-50 active:scale-95 transition-all"
                            >
                                <RefreshCw size={18} className={isLoading ? 'animate-spin' : ''} />
                                {isLoading ? 'Updating...' : 'Update Data'}
                            </button>

                            <div className="flex bg-white p-1 rounded-xl shadow-sm border border-slate-200 overflow-x-auto">
                                {['All', 'KKP', 'Krungsri', 'Bualuang', 'TISCO'].map((amc) => (
                                    <button
                                        key={amc}
                                        onClick={() => setSelectedAmc(amc)}
                                        className={`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 whitespace-nowrap ${selectedAmc === amc
                                            ? 'bg-slate-900 text-white shadow-md'
                                            : 'text-slate-600 hover:bg-slate-100'
                                            }`}
                                    >
                                        {amc === 'All' ? 'ทั้งหมด' : amc}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* API Settings Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
                            <div className="bg-white rounded-2xl p-6 w-full max-w-md shadow-xl border border-slate-100 animate-in fade-in zoom-in duration-200">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                        <Settings className="w-5 h-5" /> API Configuration
                                    </h3>
                                    <button onClick={() => setShowSettings(false)} className="text-slate-400 hover:text-slate-600">
                                        <XCircle size={24} />
                                    </button>
                                </div>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-1">SEC API Key (Ocp-Apim-Subscription-Key)</label>
                                        <input
                                            type="password"
                                            value={apiKey}
                                            onChange={(e) => setApiKey(e.target.value)}
                                            placeholder="Enter your SEC API Key"
                                            className="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        />
                                        <p className="text-xs text-slate-400 mt-1">
                                            Get your key from <a href="https://api-portal.sec.or.th/" target="_blank" className="text-indigo-600 hover:underline">SEC API Portal</a>.
                                        </p>
                                    </div>

                                    <div className="bg-blue-50 p-3 rounded-lg border border-blue-100 text-xs text-blue-700">
                                        <p className="font-semibold mb-1">Note:</p>
                                        <p>Real-time data requires a valid API key. Without a key, the dashboard uses simulated mock data.</p>
                                    </div>

                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowSettings(false)} className="px-4 py-2 text-slate-600 font-medium hover:bg-slate-50 rounded-lg">Cancel</button>
                                        <button
                                            onClick={() => handleSaveApiKey(apiKey)}
                                            className="px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 shadow-sm"
                                        >
                                            Save Key
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Search Modal */}
                    {showSearch && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
                            <div className="bg-white rounded-2xl p-6 w-full max-w-2xl shadow-xl border border-slate-100 h-[80vh] flex flex-col animate-in fade-in zoom-in duration-200">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                        <Search className="w-5 h-5 text-indigo-600" /> Search Funds
                                    </h3>
                                    <button onClick={() => setShowSearch(false)} className="text-slate-400 hover:text-slate-600">
                                        <XCircle size={24} />
                                    </button>
                                </div>

                                {/* Search Bar */}
                                <div className="flex gap-2 mb-4">
                                    <input
                                        type="text"
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        onKeyDown={(e) => e.key === 'Enter' && handleSearchFund()}
                                        placeholder="Enter fund code or name (e.g. KKP, SCB)"
                                        className="flex-1 px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        autoFocus
                                    />
                                    <button
                                        onClick={handleSearchFund}
                                        disabled={isSearching}
                                        className="px-6 py-2 bg-slate-900 text-white font-medium rounded-lg hover:bg-slate-800 disabled:opacity-50 transition-colors"
                                    >
                                        {isSearching ? 'Searching...' : 'Search'}
                                    </button>
                                </div>

                                {/* Results List */}
                                <div className="flex-1 overflow-y-auto border border-slate-100 rounded-lg bg-slate-50 p-2">
                                    {searchResults.length > 0 ? (
                                        <div className="space-y-2">
                                            {searchResults.map((res, idx) => (
                                                <div key={idx} className="bg-white p-4 rounded-lg shadow-sm border border-slate-100 hover:border-indigo-200 transition-colors flex justify-between items-center group">
                                                    <div>
                                                        <div className="flex items-center gap-2">
                                                            <span className="font-bold text-slate-800">{res.proj_abbr_name}</span>
                                                            <span className="text-xs text-slate-400 font-mono tracking-tight">{res.proj_id}</span>
                                                        </div>
                                                        <p className="text-sm text-slate-600">{res.proj_name_th}</p>
                                                        <p className="text-xs text-slate-400">{res.proj_name_en}</p>
                                                    </div>
                                                    <button className="opacity-0 group-hover:opacity-100 transition-opacity p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg" title="Add to Dashboard (Coming Soon)">
                                                        <PlusCircle size={20} />
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="h-full flex flex-col items-center justify-center text-slate-400">
                                            {isSearching ? (
                                                <RefreshCw className="animate-spin w-8 h-8 mb-2" />
                                            ) : (
                                                <>
                                                    <Search className="w-12 h-12 mb-2 opacity-20" />
                                                    <p>Enter a keyword to search for funds.</p>
                                                    <p className="text-xs mt-1">Requires valid API Key.</p>
                                                </>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {apiError && (
                        <div className="mb-6 p-4 bg-red-50 text-red-600 rounded-xl border border-red-100 flex items-center gap-2">
                            <AlertCircle size={20} />
                            <span>{apiError}</span>
                        </div>
                    )}


                    {/* KPI Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">

                        {/* Card 1: Best Performer */}
                        <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 flex items-center justify-between relative overflow-hidden group hover:shadow-md transition-shadow">
                            <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                <Trophy size={64} color={AMC_COLORS[stats.bestFund?.amc || 'All']} />
                            </div>
                            <div>
                                <p className="text-sm font-medium text-slate-500 mb-1">
                                    Top Performer ({showNewOnly ? 'YTD' : getSortLabel(sortBy)})
                                </p>
                                <h3 className="text-2xl font-bold text-slate-800 tracking-tight">
                                    {stats.bestFund ? stats.bestFund.code : '-'}
                                </h3>
                                <div className="flex items-center gap-2 mt-2">
                                    <span className={`text-xs px-2 py-1 rounded-full font-bold text-white`}
                                        style={{ backgroundColor: stats.bestFund ? AMC_COLORS[stats.bestFund.amc] : '#ccc' }}>
                                        {stats.bestFund ? stats.bestFund.amc : '-'}
                                    </span>
                                    <span className="text-lg font-bold text-green-600 flex items-center">
                                        +{stats.bestFund ? stats.bestFund[stats.metric].toFixed(2) : 0}% <ArrowUpRight size={16} />
                                    </span>
                                </div>
                            </div>
                        </div>

                        {/* Card 2: Average Return */}
                        <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 flex items-center">
                            <div className="mr-4 bg-indigo-50 p-3 rounded-full">
                                <TrendingUp className="text-indigo-600 w-6 h-6" />
                            </div>
                            <div>
                                <p className="text-sm font-medium text-slate-500 mb-1">Average Return ({showNewOnly ? 'YTD' : getSortLabel(sortBy)})</p>
                                <h3 className={`text-2xl font-bold tracking-tight ${stats.avgReturn >= 0 ? 'text-green-600' : 'text-red-500'}`}>
                                    {stats.avgReturn.toFixed(2)}%
                                </h3>
                                <p className="text-xs text-slate-400 mt-1">จากทั้งหมด {filteredFunds.length} กองทุน</p>
                            </div>
                        </div>

                        {/* Card 3: New Funds Count (Dynamic) */}
                        <div
                            onClick={() => setShowNewOnly(!showNewOnly)}
                            className={`cursor-pointer rounded-2xl p-6 shadow-sm border transition-all duration-200 flex items-center ${showNewOnly ? 'bg-orange-50 border-orange-200 ring-2 ring-orange-100' : 'bg-white border-slate-100 hover:border-orange-200'
                                }`}
                        >
                            <div className={`mr-4 p-3 rounded-full ${showNewOnly ? 'bg-orange-200' : 'bg-orange-50'}`}>
                                <Sparkles className="text-orange-600 w-6 h-6" />
                            </div>
                            <div>
                                <p className="text-sm font-medium text-slate-500 mb-1">
                                    {showNewOnly ? 'แสดงกองทุนใหม่เท่านั้น' : 'กองทุนมาใหม่ (New Arrivals)'}
                                </p>
                                <h3 className="text-2xl font-bold text-slate-800 tracking-tight flex items-center gap-2">
                                    {funds.filter(f => f.isNew).length} <span className="text-sm font-normal text-slate-400">กองทุน</span>
                                </h3>
                                <p className="text-xs text-orange-500 font-medium mt-1">
                                    {showNewOnly ? 'คลิกเพื่อดูทั้งหมด' : 'คลิกเพื่อกรองเฉพาะกองทุนใหม่'}
                                </p>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">

                        {/* Main Chart */}
                        <div className="lg:col-span-2 bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
                            <div className="flex justify-between items-center mb-6">
                                <h3 className="text-lg font-semibold text-slate-800">
                                    Top 5 Performance <span className="text-slate-400 font-normal text-sm">({showNewOnly ? 'Based on YTD' : getSortLabel(sortBy)})</span>
                                </h3>
                                <div className="flex items-center gap-2 text-sm text-slate-500 flex-wrap">
                                    <span className="w-2 h-2 rounded-full bg-purple-600"></span> KKP
                                    <span className="w-2 h-2 rounded-full bg-yellow-500 ml-1"></span> Krungsri
                                    <span className="w-2 h-2 rounded-full bg-blue-800 ml-1"></span> Bualuang
                                    <span className="w-2 h-2 rounded-full bg-red-600 ml-1"></span> TISCO
                                </div>
                            </div>
                            <div className="h-80 w-full">
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart data={chartData} layout="vertical" margin={{ top: 5, right: 30, left: 40, bottom: 5 }}>
                                        <CartesianGrid strokeDasharray="3 3" horizontal={false} stroke="#e2e8f0" />
                                        <XAxis type="number" unit="%" tick={{ fill: '#64748b', fontSize: 12 }} />
                                        <YAxis dataKey="name" type="category" width={110} tick={{ fill: '#475569', fontSize: 11, fontWeight: 500 }} />
                                        <Tooltip
                                            cursor={{ fill: '#f1f5f9' }}
                                            contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}
                                            formatter={(value) => [`${value.toFixed(2)}%`, `Return`]}
                                        />
                                        <Bar dataKey="return" radius={[0, 4, 4, 0]} barSize={28}>
                                            {chartData.map((entry, index) => (
                                                <Cell key={`cell-${index}`} fill={AMC_COLORS[entry.amc]} />
                                            ))}
                                        </Bar>
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        </div>

                        {/* Summary / Filter Note */}
                        <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 flex flex-col">
                            <h3 className="text-lg font-semibold text-slate-800 mb-4">Highlights</h3>

                            <div className="flex-1 space-y-4">
                                {/* Dynamic Insight based on filter */}
                                {showNewOnly ? (
                                    <div className="p-4 bg-orange-50 rounded-xl border border-orange-100">
                                        <h4 className="text-sm font-bold text-orange-700 mb-2 flex items-center gap-2">
                                            <Sparkles size={16} /> New Fund Insight
                                        </h4>
                                        <p className="text-sm text-orange-800/80 leading-relaxed">
                                            กองทุน RMF ใหม่ในปีนี้เน้น Theme การลงทุนเฉพาะทาง (Thematic) เช่น <span className="font-semibold">Cloud Computing</span> และ <span className="font-semibold">Semiconductor</span> รวมถึงตลาดเกิดใหม่อย่าง <span className="font-semibold">India</span>
                                        </p>
                                    </div>
                                ) : (
                                    <div className="p-4 bg-slate-50 rounded-xl border border-slate-100">
                                        <h4 className="text-sm font-bold text-slate-700 mb-2">Market Insight</h4>
                                        <p className="text-sm text-slate-600 leading-relaxed">
                                            กลุ่ม Technology และ US Equity ยังคงเป็นผู้นำตลาด โดยมีกองทุนจาก <span className="font-semibold text-red-600">TISCO</span> และ <span className="font-semibold text-purple-600">KKP</span> โดดเด่นในกลุ่มนี้
                                        </p>
                                    </div>
                                )}

                                <div className="mt-4">
                                    <h4 className="text-xs font-bold text-slate-400 uppercase mb-3">Available Categories</h4>
                                    <div className="flex flex-wrap gap-2">
                                        {Array.from(new Set(filteredFunds.map(f => f.type))).map(type => (
                                            <span key={type} className="px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded border border-slate-200">
                                                {type}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    {/* Fund List Table */}
                    <div className="mt-8 bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                        <div className="p-6 border-b border-slate-100 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                            <h3 className="text-lg font-semibold text-slate-800 flex items-center gap-2">
                                {showNewOnly ? 'รายการกองทุนใหม่ (New Arrivals)' : 'ตารางผลตอบแทนย้อนหลัง'}
                                {showNewOnly && <span className="bg-orange-100 text-orange-600 text-xs px-2 py-0.5 rounded-full">Showing {filteredFunds.length} items</span>}
                            </h3>

                            <div className="flex items-center gap-2 text-sm bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-200">
                                <Filter size={16} className="text-slate-400" />
                                <span className="text-slate-600">Sort by:</span>
                                <select
                                    className="bg-transparent font-medium text-indigo-600 outline-none cursor-pointer"
                                    value={sortBy}
                                    onChange={(e) => setSortBy(e.target.value)}
                                >
                                    <option value="ytd">YTD Return</option>
                                    <option value="return1y">1 Year Return</option>
                                    <option value="return2y">2 Year Return</option>
                                    <option value="return3y">3 Year Return</option>
                                    <option value="return5y">5 Year Return</option>
                                </select>
                            </div>
                        </div>

                        <div className="overflow-x-auto">
                            <table className="w-full text-left border-collapse">
                                <thead>
                                    <tr className="bg-slate-50 text-slate-500 text-sm uppercase tracking-wider">
                                        <th className="p-4 font-medium">ชื่อกองทุน</th>
                                        <th className="p-4 font-medium hidden lg:table-cell">ประเภท</th>
                                        <th className="p-4 font-medium text-center">ความเสี่ยง</th>
                                        <th className={`p-4 font-medium text-right ${sortBy === 'ytd' || showNewOnly ? 'text-indigo-600 bg-indigo-50/50' : ''}`}>YTD</th>
                                        <th className={`p-4 font-medium text-right ${sortBy === 'return1y' && !showNewOnly ? 'text-indigo-600 bg-indigo-50/50' : ''}`}>1Y</th>
                                        <th className="p-4 font-medium text-right hidden sm:table-cell">2Y</th>
                                        <th className="p-4 font-medium text-right hidden md:table-cell">3Y</th>
                                        <th className="p-4 font-medium text-right hidden md:table-cell">5Y</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                    {filteredFunds.map((fund) => (
                                        <tr key={fund.id} className="hover:bg-slate-50/80 transition-colors">
                                            <td className="p-4">
                                                <div className="flex flex-col">
                                                    <div className="flex items-center gap-2">
                                                        <span className="font-bold text-slate-800">{fund.code}</span>
                                                        {fund.isNew && (
                                                            <span className="px-1.5 py-0.5 bg-orange-100 text-orange-600 text-[10px] font-bold rounded uppercase border border-orange-200">
                                                                New
                                                            </span>
                                                        )}
                                                    </div>
                                                    <span className="text-xs text-slate-400 hidden sm:inline-block">{fund.name}</span>

                                                    {/* External Links */}
                                                    <div className="flex gap-2 mt-1">
                                                        <a href={`https://www.finnomena.com/fund/${fund.code.replace(/\s+/g, '-')}`} target="_blank" rel="noopener noreferrer" className="text-[10px] text-blue-500 hover:text-blue-700 hover:underline flex items-center gap-0.5 transition-colors">
                                                            Finnomena <ExternalLink size={10} />
                                                        </a>
                                                        <a href={`https://www.wealthmagik.com/FundInfo/FundProfile.aspx?FundCode=${fund.code}`} target="_blank" rel="noopener noreferrer" className="text-[10px] text-orange-500 hover:text-orange-700 hover:underline flex items-center gap-0.5 transition-colors">
                                                            WealthMagik <ExternalLink size={10} />
                                                        </a>
                                                    </div>

                                                    <span className={`text-[10px] uppercase font-bold mt-1 w-fit px-1.5 py-0.5 rounded text-white sm:hidden`}
                                                        style={{ backgroundColor: AMC_COLORS[fund.amc] }}>
                                                        {fund.amc}
                                                    </span>
                                                </div>
                                            </td>
                                            <td className="p-4 hidden lg:table-cell">
                                                <span className="px-2 py-1 rounded-md bg-slate-100 text-xs font-medium text-slate-600 border border-slate-200">
                                                    {fund.type}
                                                </span>
                                                <div className="mt-1 flex items-center gap-1">
                                                    <div className={`w-2 h-2 rounded-full`} style={{ backgroundColor: AMC_COLORS[fund.amc] }}></div>
                                                    <span className="text-xs text-slate-400">{fund.amc}</span>
                                                </div>
                                            </td>
                                            <td className="p-4 text-center">
                                                <div className="inline-flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 text-slate-600 font-bold text-sm">
                                                    {fund.risk}
                                                </div>
                                            </td>
                                            {/* Return Columns */}
                                            <td className={`p-4 text-right font-mono ${sortBy === 'ytd' || showNewOnly ? 'bg-indigo-50/30 font-bold' : ''}`}>
                                                {renderReturnCell(fund.ytd, sortBy === 'ytd' || showNewOnly)}
                                            </td>
                                            <td className={`p-4 text-right font-mono ${sortBy === 'return1y' && !showNewOnly ? 'bg-indigo-50/30' : ''}`}>
                                                {renderReturnCell(fund.return1y, sortBy === 'return1y')}
                                            </td>
                                            <td className="p-4 text-right font-mono hidden sm:table-cell">
                                                {renderReturnCell(fund.return2y, sortBy === 'return2y')}
                                            </td>
                                            <td className="p-4 text-right font-mono hidden md:table-cell">
                                                {renderReturnCell(fund.return3y, sortBy === 'return3y')}
                                            </td>
                                            <td className="p-4 text-right font-mono hidden md:table-cell">
                                                {renderReturnCell(fund.return5y, sortBy === 'return5y')}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>

                            {filteredFunds.length === 0 && (
                                <div className="p-12 text-center text-slate-400">
                                    <p>ไม่พบข้อมูลกองทุนตามเงื่อนไขที่เลือก</p>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="mt-8 text-center text-xs text-slate-400">
                        <p>* ข้อมูลจำลอง (Mock Data) | กดปุ่ม "Update Data" เพื่อจำลองการดึงข้อมูลล่าสุด</p>
                        <p>ผลการดำเนินงานในอดีต มิได้เป็นสิ่งยืนยันถึงผลการดำเนินงานในอนาคต</p>
                        <p className="mt-2">© 2024 ZeroTrust.in.th | <a href="index.html" className="hover:text-slate-600 transition-colors">Funds Portal</a></p>
                    </div>

                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<RmfDashboard />);
    </script>
</body>

</html>