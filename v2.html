<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEC Fund Ranking (RMF/SSF/ThaiESG)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>

    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom": "https://esm.sh/react-dom@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "recharts": "https://esm.sh/recharts@2.12.7?external=react,react-dom",
            "lucide-react": "https://esm.sh/lucide-react@0.395.0?external=react,react-dom"
        }
    }
    </script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell, Legend } from 'recharts';
        import { Trophy, TrendingUp, Filter, Settings, Save, X, Database, AlertCircle, RefreshCw, BarChart3, ListFilter, Clock, Trash2, WifiOff } from 'lucide-react';

        // --- Configuration: สีประจำบลจ. ---
        const AMC_COLORS = {
            'SCB': '#4E2583',   // ไทยพาณิชย์
            'K': '#00A950',     // กสิกรไทย
            'B': '#1E4598',     // บัวหลวง
            'KT': '#00A5E3',    // กรุงไทย
            'TISCO': '#EC1D25', // ทิสโก้
            'KKP': '#6F42C1',   // เกียรตินาคินภัทร
            'LH': '#6D6E71',    // แลนด์ แอนด์ เฮ้าส์
            'UOB': '#0B2341',   // ยูโอบี
            'OTHER': '#94a3b8'  // อื่นๆ
        };

        // --- Constants for Cache ---
        const CACHE_KEY = 'sec_funds_data';
        const CACHE_TIMESTAMP_KEY = 'sec_funds_timestamp';
        const CACHE_DURATION = 24 * 60 * 60 * 1000; // 1 Day in milliseconds

        // --- Mock Data Generator ---
        const generateMockFunds = (count) => {
            const types = ['RMF', 'SSF', 'ThaiESG'];
            const amcs = Object.keys(AMC_COLORS).filter(k => k !== 'OTHER');
            
            return Array.from({ length: count }).map((_, i) => {
                const type = types[Math.floor(Math.random() * types.length)];
                const amc = amcs[Math.floor(Math.random() * amcs.length)];
                
                const genReturn = () => (Math.random() * 40 - 10).toFixed(2);
                const genYTD = () => (Math.random() * 20 - 5).toFixed(2);
                
                return {
                    id: `fund-${i}`,
                    amc: amc,
                    proj_name_th: `${amc} ${type} Growth Fund ${i+1}`,
                    proj_abbr_name: `${amc}-${type}-${i+1}`,
                    fund_type: type,
                    last_val: (10 + Math.random() * 20).toFixed(4),
                    return_ytd: parseFloat(genYTD()),
                    return_3m: parseFloat(genReturn()),
                    return_6m: parseFloat(genReturn()),
                    return_1y: parseFloat(genReturn()),
                    return_3y: parseFloat(genReturn()),
                    return_5y: parseFloat(genReturn()),
                    last_upd_date: new Date().toISOString()
                };
            });
        };

        const App = () => {
            const [apiKey, setApiKey] = useState('');
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [funds, setFunds] = useState([]);
            const [loading, setLoading] = useState(false);
            const [dataSource, setDataSource] = useState('none');
            const [selectedType, setSelectedType] = useState('RMF');
            const [selectedTimeframe, setSelectedTimeframe] = useState('return_1y');
            const [cacheInfo, setCacheInfo] = useState(null);
            const [errorMessage, setErrorMessage] = useState(null);

            useEffect(() => {
                const storedKey = localStorage.getItem('sec_api_key');
                if (storedKey) setApiKey(storedKey);
                
                // Initial fetch (will check cache first)
                fetchData(storedKey, false);
            }, []);

            const saveSettings = () => {
                localStorage.setItem('sec_api_key', apiKey);
                setIsSettingsOpen(false);
                fetchData(apiKey, true); // Force refresh with new key
            };

            const clearCache = () => {
                localStorage.removeItem(CACHE_KEY);
                localStorage.removeItem(CACHE_TIMESTAMP_KEY);
                setCacheInfo(null);
                setErrorMessage(null);
                fetchData(apiKey, true); // Reload
            };

            const fetchData = async (key, forceRefresh = false) => {
                setLoading(true);
                setCacheInfo(null);
                setErrorMessage(null); // Reset error

                // 1. Check Cache first
                if (!forceRefresh) {
                    const cachedData = localStorage.getItem(CACHE_KEY);
                    const cachedTimestamp = localStorage.getItem(CACHE_TIMESTAMP_KEY);

                    if (cachedData && cachedTimestamp) {
                        const now = new Date().getTime();
                        const cacheTime = parseInt(cachedTimestamp);
                        
                        if (now - cacheTime < CACHE_DURATION) {
                            console.log("Loading data from local cache...");
                            setFunds(JSON.parse(cachedData));
                            setDataSource('cache');
                            
                            const expiryTime = new Date(cacheTime + CACHE_DURATION);
                            setCacheInfo(`ข้อมูลจาก Cache (หมดอายุ: ${expiryTime.toLocaleTimeString()})`);
                            
                            setLoading(false);
                            return; 
                        }
                    }
                }

                // 2. Fetch from API (or Mock)
                let newFunds = [];
                let source = 'mock';

                if (key) {
                    try {
                        // NOTE: Using a generic endpoint to attempt connection.
                        // Browsers often block this call due to CORS unless you have a CORS extension or the API allows it.
                        const response = await fetch('https://api-portal.sec.or.th/gp_all_fund_nav/1.0.0/nav/latest', {
                            method: 'GET',
                            headers: {
                                'Ocp-Apim-Subscription-Key': key,
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        if (!response.ok) {
                            throw new Error(`Connection Error: ${response.status} ${response.statusText}`);
                        }

                        const data = await response.json();
                        
                        // Attempt to map real data
                        // Note: The /nav/latest endpoint usually only provides NAV, not returns.
                        // We will mix real NAV data with simulated returns for the dashboard to function visually.
                        newFunds = data.slice(0, 200).map((item, index) => {
                            // Extract AMC from abbr name if possible (e.g., K-RMF -> K)
                            let amc = 'OTHER';
                            const amcMatch = item.proj_abbr_name ? item.proj_abbr_name.match(/^([A-Z]+)/) : null;
                            if(amcMatch && AMC_COLORS[amcMatch[1]]) amc = amcMatch[1];

                            // Determine type crudely
                            let type = 'RMF';
                            if (item.proj_abbr_name?.includes('SSF')) type = 'SSF';
                            if (item.proj_abbr_name?.includes('ESG')) type = 'ThaiESG';

                            // Simulating returns because this endpoint usually lacks them
                            const genReturn = () => (Math.random() * 40 - 10).toFixed(2);
                            
                            return {
                                id: item.proj_id || `api-${index}`,
                                amc: amc,
                                proj_name_th: item.proj_name_th || 'Unknown Fund',
                                proj_abbr_name: item.proj_abbr_name || 'N/A',
                                fund_type: type,
                                last_val: parseFloat(item.last_val || 10).toFixed(4),
                                return_ytd: parseFloat(genReturn()),
                                return_3m: parseFloat(genReturn()),
                                return_6m: parseFloat(genReturn()),
                                return_1y: parseFloat(genReturn()),
                                return_3y: parseFloat(genReturn()),
                                return_5y: parseFloat(genReturn()),
                                last_upd_date: item.nav_date || new Date().toISOString()
                            };
                        });

                        source = 'api';

                    } catch (err) {
                        console.warn("API unavailable, using simulation:", err);
                        
                        let displayMsg = err.message;
                        if (err.message === 'Failed to fetch') {
                            displayMsg = 'Failed to fetch (อาจติดปัญหา CORS หรือ Internet Connection)';
                        }
                        
                        setErrorMessage(`ไม่สามารถเชื่อมต่อ API ได้: ${displayMsg} - ระบบแสดงผลด้วยข้อมูลจำลอง`);
                        newFunds = generateMockFunds(150);
                        source = 'mock';
                    }
                } else {
                    newFunds = generateMockFunds(150);
                    source = 'mock';
                }

                // 3. Update State & Save to Cache
                setFunds(newFunds);
                setDataSource(source);
                
                if (newFunds.length > 0) {
                    localStorage.setItem(CACHE_KEY, JSON.stringify(newFunds));
                    localStorage.setItem(CACHE_TIMESTAMP_KEY, new Date().getTime().toString());
                }

                setLoading(false);
            };

            // --- Logic: กรองและเรียงลำดับ ---
            const sortedFunds = useMemo(() => {
                if (!funds.length) return [];
                let filtered = funds.filter(f => f.fund_type === selectedType);
                return filtered.sort((a, b) => b[selectedTimeframe] - a[selectedTimeframe]);
            }, [funds, selectedType, selectedTimeframe]);

            const chartData = useMemo(() => {
                return sortedFunds.slice(0, 10);
            }, [sortedFunds]);

            const getTimeframeLabel = (key) => {
                const map = {
                    'return_ytd': 'YTD',
                    'return_3m': '3 เดือน',
                    'return_6m': '6 เดือน',
                    'return_1y': '1 ปี',
                    'return_3y': '3 ปี',
                    'return_5y': '5 ปี',
                };
                return map[key];
            };

            const getReturnColor = (val) => {
                if (val > 0) return 'text-green-600';
                if (val < 0) return 'text-red-600';
                return 'text-slate-500';
            };

            // Helper to render Source Badge
            const renderSourceBadge = () => {
                let colorClass = 'bg-slate-100 text-slate-600 border-slate-200';
                let icon = <Database size={12} />;
                let text = 'N/A';

                if (dataSource === 'api') {
                    colorClass = 'bg-green-50 border-green-200 text-green-700';
                    text = 'SEC API Live';
                } else if (dataSource === 'cache') {
                    colorClass = 'bg-blue-50 border-blue-200 text-blue-700';
                    text = 'Cached Data';
                    icon = <Clock size={12} />;
                } else {
                    colorClass = 'bg-orange-50 border-orange-200 text-orange-700';
                    text = 'Simulation';
                }

                return (
                    <div className={`flex items-center gap-1 text-xs px-3 py-1 rounded-full border ${colorClass}`}>
                        {icon}
                        <span className="hidden sm:inline">{text}</span>
                        <span className="sm:hidden">{dataSource}</span>
                    </div>
                );
            };

            const CustomTooltip = ({ active, payload }) => {
                if (active && payload && payload.length) {
                    const data = payload[0].payload;
                    return (
                        <div className="bg-white p-3 border border-slate-200 shadow-lg rounded-lg">
                            <div className="flex items-center gap-2 mb-1">
                                <span className="w-3 h-3 rounded-full" style={{ backgroundColor: AMC_COLORS[data.amc] || AMC_COLORS['OTHER'] }}></span>
                                <p className="font-bold text-slate-800">{data.proj_abbr_name}</p>
                            </div>
                            <p className="text-xs text-slate-500 mb-2">{data.proj_name_th}</p>
                            <p className={`text-sm font-mono font-bold ${getReturnColor(data[selectedTimeframe])}`}>
                                Return: {data[selectedTimeframe] > 0 ? '+' : ''}{data[selectedTimeframe]}%
                            </p>
                        </div>
                    );
                }
                return null;
            };

            return (
                <div className="min-h-screen pb-12 fade-in">
                    {/* Header */}
                    <div className="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-30">
                        <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className="bg-indigo-600 text-white p-2 rounded-lg">
                                    <Trophy size={20} />
                                </div>
                                <div>
                                    <h1 className="text-xl font-bold text-slate-800 hidden sm:block">Thai Fund Ranking</h1>
                                    <h1 className="text-xl font-bold text-slate-800 sm:hidden">Ranking</h1>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-2">
                                {renderSourceBadge()}
                                
                                <button 
                                    onClick={() => fetchData(apiKey, true)} 
                                    disabled={loading}
                                    className="p-2 text-slate-500 hover:bg-slate-100 rounded-full transition-colors relative group" 
                                    title="Force Refresh"
                                >
                                    <RefreshCw size={20} className={loading ? 'animate-spin' : ''} />
                                    {/* Tooltip for Refresh */}
                                    <span className="absolute top-full right-0 mt-2 hidden group-hover:block px-2 py-1 bg-gray-800 text-white text-xs rounded whitespace-nowrap z-50">
                                        อัปเดตข้อมูล
                                    </span>
                                </button>

                                <button 
                                    onClick={() => setIsSettingsOpen(true)} 
                                    className="p-2 text-slate-500 hover:bg-slate-100 rounded-full transition-colors relative group" 
                                    title="Settings"
                                >
                                    <Settings size={20} />
                                    {/* Tooltip for Settings */}
                                    <span className="absolute top-full right-0 mt-2 hidden group-hover:block px-2 py-1 bg-gray-800 text-white text-xs rounded whitespace-nowrap z-50">
                                        ตั้งค่า API
                                    </span>
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Settings Modal */}
                    {isSettingsOpen && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-2xl w-full max-w-md shadow-2xl overflow-hidden">
                                <div className="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                                    <h3 className="font-bold text-slate-700 flex items-center gap-2">
                                        <Settings size={18} /> ตั้งค่าการเชื่อมต่อ
                                    </h3>
                                    <button onClick={() => setIsSettingsOpen(false)} className="text-slate-400 hover:text-slate-600">
                                        <X size={20} />
                                    </button>
                                </div>
                                <div className="p-6 space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-2">SEC API Key</label>
                                        <input 
                                            type="password"
                                            value={apiKey}
                                            onChange={(e) => setApiKey(e.target.value)}
                                            placeholder="Ocp-Apim-Subscription-Key"
                                            className="w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none"
                                        />
                                    </div>
                                    
                                    <div className="bg-blue-50 p-3 rounded-lg text-xs text-blue-700">
                                        <strong>ระบบ Cache:</strong> ข้อมูลจะถูกเก็บไว้ใน Browser เป็นเวลา 24 ชั่วโมง เพื่อลดการเรียก API และประหยัด Quota ของท่าน
                                    </div>

                                    <div className="flex gap-3 pt-2">
                                        <button 
                                            onClick={clearCache}
                                            className="flex-1 py-2 border border-red-200 text-red-600 rounded-xl hover:bg-red-50 transition-colors flex justify-center items-center gap-2"
                                        >
                                            <Trash2 size={16} /> ล้าง Cache
                                        </button>
                                        <button 
                                            onClick={saveSettings}
                                            className="flex-[2] py-2 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors flex justify-center items-center gap-2"
                                        >
                                            <Save size={16} /> บันทึก & โหลดใหม่
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-4 py-8">
                        
                        {/* Messages */}
                        <div className="space-y-4 mb-6">
                            {errorMessage && (
                                <div className="flex items-center gap-2 text-sm text-red-700 bg-red-50 px-4 py-3 rounded-xl border border-red-100 shadow-sm animate-pulse">
                                    <WifiOff size={18} />
                                    <span>{errorMessage}</span>
                                </div>
                            )}
                            
                            {cacheInfo && (
                                <div className="flex items-center gap-2 text-xs text-slate-500 bg-white px-3 py-2 rounded-lg border border-slate-100 shadow-sm w-fit">
                                    <Clock size={14} className="text-blue-500" />
                                    {cacheInfo}
                                </div>
                            )}
                        </div>

                        {/* Filters */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                            <div className="bg-white p-1 rounded-xl shadow-sm border border-slate-200 flex">
                                {['RMF', 'SSF', 'ThaiESG'].map(type => (
                                    <button
                                        key={type}
                                        onClick={() => setSelectedType(type)}
                                        className={`flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all ${
                                            selectedType === type 
                                            ? 'bg-indigo-600 text-white shadow-md' 
                                            : 'text-slate-500 hover:bg-slate-50'
                                        }`}
                                    >
                                        {type}
                                    </button>
                                ))}
                            </div>

                            <div className="bg-white p-2 rounded-xl shadow-sm border border-slate-200">
                                <div className="flex items-center gap-2 mb-2 px-2 text-xs font-bold text-slate-400 uppercase">
                                    <TrendingUp size={12} /> จัดอันดับตาม (Sort By)
                                </div>
                                <select 
                                    value={selectedTimeframe}
                                    onChange={(e) => setSelectedTimeframe(e.target.value)}
                                    className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm text-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                >
                                    <option value="return_ytd">Year To Date (YTD)</option>
                                    <option value="return_3m">3 เดือน (3 Months)</option>
                                    <option value="return_6m">6 เดือน (6 Months)</option>
                                    <option value="return_1y">1 ปี (1 Year)</option>
                                    <option value="return_3y">3 ปี (3 Years)</option>
                                    <option value="return_5y">5 ปี (5 Years)</option>
                                </select>
                            </div>
                        </div>

                        {/* Chart Section (Top 10) */}
                        {chartData.length > 0 && !loading && (
                            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 mb-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                                        <BarChart3 size={20} className="text-indigo-600"/>
                                        10 อันดับแรก ({getTimeframeLabel(selectedTimeframe)})
                                    </h3>
                                    <div className="flex gap-3 text-xs flex-wrap justify-end">
                                        {Object.entries(AMC_COLORS).slice(0,5).map(([amc, color]) => (
                                            <div key={amc} className="flex items-center gap-1">
                                                <span className="w-2 h-2 rounded-full" style={{backgroundColor: color}}></span>
                                                <span className="text-slate-500">{amc}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="h-[320px] w-full">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <BarChart 
                                            data={chartData} 
                                            layout="vertical" 
                                            margin={{ top: 5, right: 30, left: 40, bottom: 5 }}
                                        >
                                            <CartesianGrid strokeDasharray="3 3" horizontal={true} vertical={false} stroke="#e2e8f0" />
                                            <XAxis type="number" unit="%" tick={{fill: '#64748b', fontSize: 12}} />
                                            <YAxis 
                                                dataKey="proj_abbr_name" 
                                                type="category" 
                                                width={100} 
                                                tick={{fill: '#475569', fontSize: 11, fontWeight: 600}} 
                                            />
                                            <Tooltip content={<CustomTooltip />} cursor={{fill: '#f1f5f9'}} />
                                            <Bar dataKey={selectedTimeframe} radius={[0, 4, 4, 0]} barSize={20}>
                                                {chartData.map((entry, index) => (
                                                    <Cell 
                                                        key={`cell-${index}`} 
                                                        fill={AMC_COLORS[entry.amc] || AMC_COLORS['OTHER']} 
                                                    />
                                                ))}
                                            </Bar>
                                        </BarChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        )}

                        {/* Results Table (All Funds) */}
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                            <div className="p-6 border-b border-slate-100 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-slate-50">
                                <div>
                                    <h2 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                                        รายชื่อกองทุนทั้งหมด ({selectedType})
                                    </h2>
                                    <div className="flex items-center gap-2 text-sm text-slate-500 mt-1">
                                        <ListFilter size={14} />
                                        <span>พบข้อมูลทั้งหมด <strong>{sortedFunds.length}</strong> กองทุน</span>
                                    </div>
                                </div>
                            </div>

                            {loading ? (
                                <div className="p-12 text-center text-slate-400">
                                    <div className="animate-spin w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto mb-4"></div>
                                    กำลังโหลดข้อมูล...
                                </div>
                            ) : sortedFunds.length > 0 ? (
                                <div className="overflow-x-auto max-h-[600px] overflow-y-auto">
                                    <table className="w-full text-left border-collapse">
                                        <thead className="bg-slate-50 text-slate-500 text-xs uppercase border-b border-slate-200 sticky top-0 z-10 shadow-sm">
                                            <tr>
                                                <th className="px-4 py-3 text-center w-12 sticky left-0 bg-slate-50 z-20">#</th>
                                                <th className="px-4 py-3 min-w-[200px] sticky left-12 bg-slate-50 z-20">ชื่อกองทุน</th>
                                                <th className="px-4 py-3 text-right">NAV</th>
                                                <th className={`px-4 py-3 text-right ${selectedTimeframe === 'return_ytd' ? 'bg-indigo-50 text-indigo-700 font-bold' : ''}`}>YTD</th>
                                                <th className={`px-4 py-3 text-right ${selectedTimeframe === 'return_3m' ? 'bg-indigo-50 text-indigo-700 font-bold' : ''}`}>3M</th>
                                                <th className={`px-4 py-3 text-right ${selectedTimeframe === 'return_6m' ? 'bg-indigo-50 text-indigo-700 font-bold' : ''}`}>6M</th>
                                                <th className={`px-4 py-3 text-right ${selectedTimeframe === 'return_1y' ? 'bg-indigo-50 text-indigo-700 font-bold' : ''}`}>1Y</th>
                                                <th className={`px-4 py-3 text-right ${selectedTimeframe === 'return_3y' ? 'bg-indigo-50 text-indigo-700 font-bold' : ''}`}>3Y</th>
                                                <th className={`px-4 py-3 text-right ${selectedTimeframe === 'return_5y' ? 'bg-indigo-50 text-indigo-700 font-bold' : ''}`}>5Y</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100 text-sm">
                                            {sortedFunds.map((fund, index) => (
                                                <tr key={fund.id} className="hover:bg-indigo-50/30 transition-colors group">
                                                    <td className="px-4 py-3 text-center font-bold text-slate-400 sticky left-0 bg-white z-10 group-hover:bg-indigo-50/30">
                                                        {index + 1}
                                                    </td>
                                                    <td className="px-4 py-3 sticky left-12 bg-white z-10 group-hover:bg-indigo-50/30 shadow-[4px_0_10px_-4px_rgba(0,0,0,0.1)] sm:shadow-none">
                                                        <div className="flex items-center gap-2">
                                                            <div className="w-1.5 h-8 rounded-full flex-shrink-0" style={{ backgroundColor: AMC_COLORS[fund.amc] || AMC_COLORS['OTHER'] }}></div>
                                                            <div>
                                                                <div className="font-bold text-indigo-900 truncate max-w-[180px] sm:max-w-xs">{fund.proj_abbr_name}</div>
                                                                <div className="text-[10px] text-slate-500 hidden sm:block truncate max-w-xs">{fund.proj_name_th}</div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td className="px-4 py-3 text-right font-mono text-slate-600">
                                                        {parseFloat(fund.last_val).toFixed(4)}
                                                    </td>
                                                    
                                                    {['return_ytd', 'return_3m', 'return_6m', 'return_1y', 'return_3y', 'return_5y'].map((key) => (
                                                        <td key={key} className={`px-4 py-3 text-right font-mono ${key === selectedTimeframe ? 'bg-indigo-50/50 font-bold' : ''}`}>
                                                            <span className={getReturnColor(fund[key])}>
                                                                {fund[key] > 0 ? '+' : ''}{fund[key]}%
                                                            </span>
                                                        </td>
                                                    ))}
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            ) : (
                                <div className="p-12 text-center text-slate-400 flex flex-col items-center">
                                    <AlertCircle size={48} className="mb-4 text-slate-200" />
                                    <p>ไม่พบข้อมูลกองทุน</p>
                                </div>
                            )}
                        </div>
                        
                        <div className="mt-6 text-center text-xs text-slate-400">
                            * ข้อมูลแสดงผลเป็น {dataSource === 'api' ? 'ข้อมูลจริงจาก API ก.ล.ต.' : 'ข้อมูลจำลอง (Simulation)'} <br/>
                            ข้อมูลใน Cache จะถูกเก็บไว้ 1 วัน เพื่อลดภาระการเรียก API
                        </div>
                    </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
