<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RMF All-in-One Dashboard | ZeroTrust.in.th</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#fff7ed',
                            100: '#ffedd5',
                            500: '#f97316',
                            600: '#ea580c',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] {
            display: none !important;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 antialiased" x-data="rmfDashboard()" x-init="initDashboard()">

    <!-- Sticky Navigation -->
    <nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-200">
        <div class="container mx-auto px-4 md:px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-2 group">
                <div class="bg-slate-900 text-white p-1.5 rounded-lg group-hover:bg-brand-600 transition-colors">
                    <div class="bg-slate-900 text-white p-1.5 rounded-lg group-hover:bg-brand-600 transition-colors">
                        <i class="ph ph-arrow-left text-lg"></i>
                    </div>
                </div>
                <span class="font-bold text-slate-700 group-hover:text-brand-600 transition-colors">Back to Funds
                    Portal</span>
            </a>
            <div class="text-sm font-semibold text-slate-500 hidden md:block">
                ZeroTrust Investment Tools
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 md:px-6 py-8 pb-20">

        <!-- Header -->
        <div class="mb-8 flex flex-col md:flex-row justify-between items-start md:items-end gap-6">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2 flex items-center gap-3">
                    <span class="bg-indigo-100 text-indigo-600 p-2 rounded-xl">
                        <span class="bg-indigo-100 text-indigo-600 p-2 rounded-xl">
                            <i class="ph ph-chart-line-up text-3xl"></i>
                        </span>
                    </span>
                    RMF Dashboard
                </h1>
                <p class="text-slate-500 max-w-2xl">
                    Comprehensive comparison of RMF funds from KKP, Krungsri, Bualuang, and TISCO.
                    <span class="hidden sm:inline">Track performance, analyze risk, and discover new
                        opportunities.</span>
                </p>
            </div>

            <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
                <div
                    class="flex items-center gap-2 text-xs text-slate-400 bg-white px-3 py-1.5 rounded-lg border border-slate-200 shadow-sm self-start sm:self-center">
                    <i class="ph ph-clock text-base"></i>
                    Updated: <span x-text="lastUpdated"></span>
                </div>
                <button @click="refreshData()" :disabled="isLoading"
                    class="flex items-center justify-center gap-2 px-5 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl shadow-lg shadow-indigo-200 transition-all disabled:opacity-70 disabled:cursor-not-allowed transform active:scale-95">
                    <i x-show="!isLoading" class="ph ph-arrows-clockwise text-xl"></i>
                    <svg x-show="isLoading" class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg"
                        fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    <span x-text="isLoading ? 'Updating...' : 'Update Data'"></span>
                </button>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Best Fund -->
            <div
                class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 relative overflow-hidden group hover:shadow-md transition-shadow">
                <div class="absolute top-0 right-0 p-4 opacity-10">
                    <i class="ph ph-trophy text-[6rem]"></i>
                </div>
                <div class="relative z-10">
                    <p class="text-sm font-medium text-slate-500 mb-1">Top Performer (<span
                            x-text="showNewOnly ? 'YTD' : getLabel(sortBy)"></span>)</p>
                    <template x-if="stats.bestFund">
                        <div>
                            <h3 class="text-2xl font-bold text-slate-800 tracking-tight" x-text="stats.bestFund.code">
                            </h3>
                            <div class="flex items-center gap-2 mt-2">
                                <span class="text-xs px-2 py-1 rounded-full font-bold text-white shadow-sm"
                                    :style="`background-color: ${AMC_COLORS[stats.bestFund.amc]}`"
                                    x-text="stats.bestFund.amc">
                                </span>
                                <span class="text-xl font-bold text-green-600 flex items-center">
                                    +<span x-text="stats.bestFund[stats.metric].toFixed(2)"></span>%
                                </span>
                            </div>
                        </div>
                    </template>
                    <template x-if="!stats.bestFund">
                        <div class="text-slate-400 italic">No data available</div>
                    </template>
                </div>
            </div>

            <!-- Average Return -->
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 flex items-center">
                <div class="mr-5 bg-emerald-100 text-emerald-600 p-4 rounded-full">
                    <i class="ph ph-trend-up text-3xl"></i>
                </div>
                <div>
                    <p class="text-sm font-medium text-slate-500 mb-1">Average Return</p>
                    <h3 class="text-3xl font-bold tracking-tight"
                        :class="stats.avgReturn >= 0 ? 'text-emerald-600' : 'text-red-500'">
                        <span x-text="stats.avgReturn.toFixed(2)"></span>%
                    </h3>
                    <p class="text-xs text-slate-400 mt-1">From <span x-text="filteredFunds.length"></span> funds</p>
                </div>
            </div>

            <!-- Helper/Filters -->
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 flex flex-col justify-between">
                <div>
                    <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-3">Quick Filters</h3>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <template x-for="amc in ['All', 'KKP', 'Krungsri', 'Bualuang', 'TISCO']" :key="amc">
                            <button @click="selectedAmc = amc"
                                class="px-3 py-1.5 rounded-lg text-xs font-semibold transition-all"
                                :class="selectedAmc === amc ? 'bg-slate-800 text-white shadow-md transform -translate-y-0.5' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'">
                                <span x-text="amc === 'All' ? 'All AMCs' : amc"></span>
                            </button>
                        </template>
                    </div>
                </div>
                <div @click="showNewOnly = !showNewOnly"
                    class="cursor-pointer flex items-center gap-3 p-3 rounded-xl border transition-all"
                    :class="showNewOnly ? 'bg-orange-50 border-orange-200 ring-1 ring-orange-200' : 'bg-slate-50 border-slate-200 hover:border-orange-200'">
                    <div class="w-5 h-5 rounded-full border flex items-center justify-center transition-colors"
                        :class="showNewOnly ? 'bg-orange-500 border-orange-500' : 'border-slate-300 bg-white'">
                        <i x-show="showNewOnly" class="ph ph-check text-xs text-white"></i>
                    </div>
                    <div>
                        <span class="block text-sm font-bold text-slate-700">Show New Funds Only</span>
                        <span class="block text-xs text-slate-400">Highlight recently launched RMFs</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Chart Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
            <div class="lg:col-span-2 bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-slate-800">
                        Top 5 Performance
                        <span class="text-slate-400 font-normal text-sm ml-2 hidden sm:inline-block">
                            (Based on <span x-text="showNewOnly ? 'YTD' : getLabel(sortBy)"></span>)
                        </span>
                    </h3>
                </div>
                <div class="relative h-72 w-full">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>

            <!-- Highlights Panel -->
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 flex flex-col h-full">
                <h3 class="text-lg font-bold text-slate-800 mb-6">Highlights</h3>

                <!-- Market Insight -->
                <div class="bg-slate-50 rounded-xl p-5 border border-slate-100 mb-8">
                    <h4 class="text-sm font-bold text-slate-700 mb-2">Market Insight</h4>
                    <p class="text-sm text-slate-600 leading-relaxed">
                        <template x-if="showNewOnly">
                            <span>
                                New RMFs represent the <span class="font-bold text-indigo-600">future of
                                    investing</span>,
                                focusing on thematic growth like AI and Sustainability.
                            </span>
                        </template>
                        <template x-if="!showNewOnly">
                            <span>
                                <span class="font-bold text-slate-800">Technology</span> and
                                <span class="font-bold text-slate-800">US Equity</span> sectors continue to lead the
                                market.
                                Funds from <span class="font-bold text-red-600">TISCO</span> and <span
                                    class="font-bold text-purple-600">KKP</span> are standout performers in this group.
                            </span>
                        </template>
                    </p>
                </div>

                <!-- Categories -->
                <div class="mt-auto">
                    <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Available Categories</h4>
                    <div class="flex flex-wrap gap-2">
                        <template x-for="cat in uniqueCategories" :key="cat">
                            <span
                                class="px-3 py-1.5 bg-slate-50 text-slate-600 text-xs font-medium rounded-lg border border-slate-200 hover:bg-white hover:border-slate-300 transition-colors cursor-default"
                                x-text="cat"></span>
                        </template>
                    </div>
                </div>
            </div>
        </div>

        <!-- Table Controls -->
        <div class="flex flex-col sm:flex-row justify-between items-end sm:items-center gap-4 mb-4">
            <h3 class="text-xl font-bold text-slate-800">Fund Rankings</h3>
            <div
                class="flex items-center gap-2 bg-white px-3 py-2 rounded-xl shadow-sm border border-slate-200 text-sm">
                <span class="text-slate-500">Sort by:</span>
                <select x-model="sortBy"
                    class="bg-transparent font-semibold text-indigo-600 outline-none cursor-pointer">
                    <option value="ytd">YTD Return</option>
                    <option value="return1y">1 Year Return</option>
                    <option value="return2y">2 Year Return</option>
                    <option value="return3y">3 Year Return</option>
                    <option value="return5y">5 Year Return</option>
                </select>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr
                            class="bg-slate-50 border-b border-slate-200 text-xs text-slate-500 uppercase tracking-widest">
                            <th class="p-5 font-semibold">Fund Name</th>
                            <th class="p-5 font-semibold hidden lg:table-cell">Type</th>
                            <th class="p-5 font-semibold text-center">Risk</th>
                            <th class="p-5 font-semibold text-right"
                                :class="{'text-indigo-600 bg-indigo-50/50': sortBy === 'ytd' || showNewOnly}">YTD</th>
                            <th class="p-5 font-semibold text-right"
                                :class="{'text-indigo-600 bg-indigo-50/50': sortBy === 'return1y' && !showNewOnly}">1Y
                            </th>
                            <th class="p-5 font-semibold text-right hidden sm:table-cell">2Y</th>
                            <th class="p-5 font-semibold text-right hidden md:table-cell">3Y</th>
                            <th class="p-5 font-semibold text-right hidden lg:table-cell">5Y</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        <template x-for="fund in filteredFunds" :key="fund.id">
                            <tr class="hover:bg-slate-50 transition-colors group">
                                <td class="p-5">
                                    <div class="flex flex-col">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="font-bold text-slate-800 text-sm" x-text="fund.code"></span>
                                            <template x-if="fund.isNew">
                                                <span
                                                    class="px-1.5 py-0.5 bg-orange-100 text-orange-600 text-[10px] font-bold rounded uppercase border border-orange-200">New</span>
                                            </template>
                                        </div>
                                        <span
                                            class="text-xs text-slate-400 group-hover:text-slate-600 transition-colors"
                                            x-text="fund.name"></span>
                                        <!-- External Links -->
                                        <div
                                            class="flex items-center gap-3 mt-1.5 opacity-80 hover:opacity-100 transition-opacity duration-200">
                                            <a :href="`https://www.finnomena.com/fund/${fund.code.replace(/\s+/g, '-')}`"
                                                target="_blank"
                                                class="flex items-center gap-1 text-[10px] font-semibold text-yellow-600 hover:text-yellow-700 transition-colors"
                                                title="View on Finnomena">
                                                <i class="ph ph-arrow-square-out text-sm"></i>
                                                Finnomena
                                            </a>
                                            <a :href="`https://www.wealthmagik.com/funds/${encodeURIComponent(fund.code)}`"
                                                target="_blank"
                                                class="flex items-center gap-1 text-[10px] font-semibold text-blue-600 hover:text-blue-700 transition-colors"
                                                title="View on WealthMagik">
                                                <i class="ph ph-arrow-square-out text-sm"></i>
                                                WealthMagik
                                            </a>
                                        </div>
                                        <div class="mt-1 sm:hidden">
                                            <span class="text-[10px] font-bold text-white px-2 py-0.5 rounded-full"
                                                :style="`background-color: ${AMC_COLORS[fund.amc]}`"
                                                x-text="fund.amc"></span>
                                        </div>
                                    </div>
                                </td>
                                <td class="p-5 hidden lg:table-cell">
                                    <span
                                        class="px-2.5 py-1 rounded-md bg-slate-100 text-xs font-semibold text-slate-600 border border-slate-200"
                                        x-text="fund.type"></span>
                                    <div class="mt-2 flex items-center gap-1.5">
                                        <div class="w-2 h-2 rounded-full"
                                            :style="`background-color: ${AMC_COLORS[fund.amc]}`"></div>
                                        <span class="text-xs font-medium text-slate-500" x-text="fund.amc"></span>
                                    </div>
                                </td>
                                <td class="p-5 text-center">
                                    <div class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 text-slate-600 font-bold text-xs border border-slate-200"
                                        x-text="fund.risk"></div>
                                </td>

                                <!-- Return Columns -->
                                <td class="p-5 text-right font-mono"
                                    :class="{'bg-indigo-50/30': sortBy === 'ytd' || showNewOnly}">
                                    <span :class="getColor(fund.ytd)" class="font-bold"
                                        x-text="formatVal(fund.ytd)"></span>
                                </td>
                                <td class="p-5 text-right font-mono"
                                    :class="{'bg-indigo-50/30': sortBy === 'return1y' && !showNewOnly}">
                                    <span :class="getColor(fund.return1y)" x-text="formatVal(fund.return1y)"></span>
                                </td>
                                <td class="p-5 text-right font-mono hidden sm:table-cell">
                                    <span :class="getColor(fund.return2y)" x-text="formatVal(fund.return2y)"></span>
                                </td>
                                <td class="p-5 text-right font-mono hidden md:table-cell">
                                    <span :class="getColor(fund.return3y)" x-text="formatVal(fund.return3y)"></span>
                                </td>
                                <td class="p-5 text-right font-mono hidden lg:table-cell">
                                    <span :class="getColor(fund.return5y)" x-text="formatVal(fund.return5y)"></span>
                                </td>
                            </tr>
                        </template>

                        <template x-if="filteredFunds.length === 0">
                            <tr>
                                <td colspan="8" class="p-12 text-center">
                                    <div class="flex flex-col items-center text-slate-400">
                                        <i class="ph ph-magnifying-glass text-5xl mb-4 opacity-50"></i>
                                        <p>No funds found matching your filters.</p>
                                    </div>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="mt-8 text-center text-xs text-slate-400">
            <p>* Disclaimer: Mock Data for demonstration purposes.</p>
            <p>© 2024 ZeroTrust.in.th | <a href="index.html" class="hover:text-slate-600 transition-colors">Funds
                    Portal</a></p>
        </div>

    </div>

    <!-- Scripts -->
    <script>
        // Constants (from original)
        const initialFundsData = [
            // KKP
            { id: 'k1', code: 'KKP GNP RMF-H', name: 'เคเคพี โกลบอล นิว เพอร์สเปกทีฟ RMF', amc: 'KKP', nav: 16.42, ytd: 12.5, return1y: 18.2, return2y: 8.5, return3y: 6.2, return5y: 9.8, risk: 6, type: 'Global Equity', isNew: false },
            { id: 'k6', code: 'KKP NDQ100-RMF', name: 'เคเคพี Nasdaq 100 RMF', amc: 'KKP', nav: 12.50, ytd: 20.1, return1y: 28.4, return2y: 22.1, return3y: 18.5, return5y: 0, risk: 6, type: 'US Equity', isNew: false },
            { id: 'k3', code: 'KKP TECH-RMF', name: 'เคเคพี เทคโนโลยี เพื่อการเลี้ยงชีพ', amc: 'KKP', nav: 11.23, ytd: 25.4, return1y: 32.1, return2y: 28.4, return3y: 15.6, return5y: 18.9, risk: 7, type: 'Technology', isNew: false },
            { id: 'k5', code: 'KKP SEMICON-RMF', name: 'เคเคพี เซมิคอนดักเตอร์ RMF', amc: 'KKP', nav: 10.15, ytd: 15.2, return1y: 0, return2y: 0, return3y: 0, return5y: 0, risk: 7, type: 'Technology', isNew: true },
            { id: 'k7', code: 'KKP PGE-RMF', name: 'เคเคพี แพสซีฟ โกลบอล อิควิตี้ RMF', amc: 'KKP', nav: 14.20, ytd: 10.5, return1y: 15.8, return2y: 9.2, return3y: 7.5, return5y: 8.9, risk: 6, type: 'Global Equity', isNew: false },
            { id: 'k2', code: 'KKP EQRMF', name: 'เคเคพี หุ้นทุนเพื่อการเลี้ยงชีพ', amc: 'KKP', nav: 42.10, ytd: -2.1, return1y: 4.5, return2y: -1.2, return3y: 2.1, return5y: 1.5, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 'k8', code: 'KKP SET50 RMF', name: 'เคเคพี SET50 RMF', amc: 'KKP', nav: 18.50, ytd: -1.5, return1y: 3.2, return2y: -2.5, return3y: 1.8, return5y: 1.2, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 'k4', code: 'KKP SG-AA RMF', name: 'เคเคพี สตราทิจิค แอสเซ็ท อโลเคชั่น RMF', amc: 'KKP', nav: 13.88, ytd: 4.5, return1y: 6.8, return2y: 3.2, return3y: 4.1, return5y: 3.5, risk: 5, type: 'Mixed', isNew: false },
            { id: 'k9', code: 'KKP INRMF', name: 'เคเคพี ตราสารหนี้เพื่อการเลี้ยงชีพ', amc: 'KKP', nav: 15.30, ytd: 2.2, return1y: 2.5, return2y: 2.1, return3y: 1.9, return5y: 1.8, risk: 4, type: 'Fixed Income', isNew: false },
            { id: 'k10', code: 'KKP ACT FIXED RMF', name: 'เคเคพี แอคทีฟ ฟิกซ์ อินคัม RMF', amc: 'KKP', nav: 11.45, ytd: 2.8, return1y: 3.1, return2y: 2.4, return3y: 2.0, return5y: 1.9, risk: 4, type: 'Fixed Income', isNew: false },
            { id: 'k11', code: 'KKP PROP-RMF', name: 'เคเคพี อสังหาริมทรัพย์เพื่อการเลี้ยงชีพ', amc: 'KKP', nav: 9.80, ytd: -5.2, return1y: -3.5, return2y: -8.5, return3y: -5.2, return5y: -2.1, risk: 8, type: 'Property/REITs', isNew: false },
            { id: 'k12', code: 'KKP GOLD-RMF', name: 'เคเคพี โกลด์ เพื่อการเลี้ยงชีพ', amc: 'KKP', nav: 18.20, ytd: 11.5, return1y: 14.2, return2y: 9.5, return3y: 7.8, return5y: 8.5, risk: 8, type: 'Gold', isNew: false },

            // Krungsri
            { id: 'ks2', code: 'KFGBRANRMF', name: 'กรุงศรี Global Brand RMF', amc: 'Krungsri', nav: 15.67, ytd: 14.2, return1y: 19.8, return2y: 12.5, return3y: 9.8, return5y: 11.2, risk: 6, type: 'Global Equity', isNew: false },
            { id: 'ks7', code: 'KFUSRMF', name: 'กรุงศรี ยูเอส อิควิตี้ RMF', amc: 'Krungsri', nav: 22.15, ytd: 18.5, return1y: 24.2, return2y: 19.5, return3y: 12.5, return5y: 14.2, risk: 6, type: 'US Equity', isNew: false },
            { id: 'ks3', code: 'KFACHINRMF', name: 'กรุงศรี All China Equity RMF', amc: 'Krungsri', nav: 8.90, ytd: -5.4, return1y: -8.2, return2y: -15.4, return3y: -10.2, return5y: -2.5, risk: 6, type: 'China Equity', isNew: false },
            { id: 'ks4', code: 'KFVIETRMF', name: 'กรุงศรีเวียดนามอิควิตี้ RMF', amc: 'Krungsri', nav: 10.55, ytd: 18.5, return1y: 22.4, return2y: 15.6, return3y: 12.8, return5y: 14.5, risk: 7, type: 'Vietnam Equity', isNew: false },
            { id: 'ks5', code: 'KF-INDIA RMF', name: 'กรุงศรี อินเดีย อิควิตี้ RMF', amc: 'Krungsri', nav: 10.88, ytd: 8.5, return1y: 0, return2y: 0, return3y: 0, return5y: 0, risk: 7, type: 'India Equity', isNew: true },
            { id: 'ks10', code: 'KFHCARERMF', name: 'กรุงศรี โกลบอล เฮลธ์แคร์ RMF', amc: 'Krungsri', nav: 14.60, ytd: 6.5, return1y: 9.2, return2y: 4.5, return3y: 5.8, return5y: 7.2, risk: 7, type: 'Health Care', isNew: false },
            { id: 'ks11', code: 'KFEURORMF', name: 'กรุงศรี ยุโรป อิควิตี้ RMF', amc: 'Krungsri', nav: 11.20, ytd: 7.8, return1y: 11.5, return2y: 5.5, return3y: 4.2, return5y: 3.8, risk: 6, type: 'Europe Equity', isNew: false },
            { id: 'ks12', code: 'KFJPIND-RMF', name: 'กรุงศรี เจแปน RMF', amc: 'Krungsri', nav: 12.50, ytd: 12.5, return1y: 16.5, return2y: 8.5, return3y: 3.5, return5y: 2.5, risk: 6, type: 'Japan Equity', isNew: false },
            { id: 'ks1', code: 'KFLTFEQ-RMF', name: 'กรุงศรีหุ้นระยะยาวอิควิตี้ RMF', amc: 'Krungsri', nav: 18.45, ytd: 1.2, return1y: 5.4, return2y: 0.5, return3y: 3.2, return5y: 2.1, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 'ks8', code: 'KFEQRMF', name: 'กรุงศรีตราสารทุนเพื่อการเลี้ยงชีพ', amc: 'Krungsri', nav: 45.20, ytd: 2.1, return1y: 4.8, return2y: 1.5, return3y: 3.5, return5y: 2.8, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 'ks9', code: 'KFENS50RMF', name: 'กรุงศรี SET50 RMF', amc: 'Krungsri', nav: 12.30, ytd: -0.8, return1y: 3.5, return2y: -1.8, return3y: 2.0, return5y: 1.5, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 'ks13', code: 'KFPROPRMF', name: 'กรุงศรี พร็อพเพอร์ตี้ RMF', amc: 'Krungsri', nav: 13.10, ytd: -3.5, return1y: -1.2, return2y: -5.5, return3y: -3.2, return5y: -0.5, risk: 8, type: 'Property/REITs', isNew: false },
            { id: 'ks6', code: 'KFCASHRMF', name: 'กรุงศรีแคชแมเนจเมนท์ RMF', amc: 'Krungsri', nav: 12.10, ytd: 1.8, return1y: 2.1, return2y: 1.9, return3y: 1.5, return5y: 1.2, risk: 1, type: 'Money Market', isNew: false },

            // Bualuang
            { id: 'b2', code: 'B-INNOTECH RMF', name: 'บัวหลวงโกลบอลอินโนเวชั่น RMF', amc: 'Bualuang', nav: 24.12, ytd: 22.1, return1y: 28.5, return2y: 25.2, return3y: 14.8, return5y: 17.5, risk: 7, type: 'Technology', isNew: false },
            { id: 'b3', code: 'B-ASIA RMF', name: 'บัวหลวงเอเชียเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 12.34, ytd: 6.7, return1y: 9.1, return2y: 4.5, return3y: -1.2, return5y: 2.8, risk: 6, type: 'Asia Equity', isNew: false },
            { id: 'b5', code: 'B-USALPHA RMF', name: 'บัวหลวงยูเอสอัลฟ่า RMF', amc: 'Bualuang', nav: 14.50, ytd: 18.2, return1y: 24.5, return2y: 20.1, return3y: 0, return5y: 0, risk: 6, type: 'US Equity', isNew: false },
            { id: 'b6', code: 'B-EV RMF', name: 'บัวหลวงโกลบอล อีวี RMF', amc: 'Bualuang', nav: 9.85, ytd: 5.4, return1y: 0, return2y: 0, return3y: 0, return5y: 0, risk: 7, type: 'Technology', isNew: true },
            { id: 'b7', code: 'B-GLOBALRMF', name: 'บัวหลวงโกลบอลเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 16.80, ytd: 11.5, return1y: 15.2, return2y: 10.5, return3y: 8.4, return5y: 9.5, risk: 6, type: 'Global Equity', isNew: false },
            { id: 'b8', code: 'B-NIPPONRMF', name: 'บัวหลวงนิปปอนเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 13.50, ytd: 14.5, return1y: 18.2, return2y: 12.5, return3y: 5.5, return5y: 0, risk: 6, type: 'Japan Equity', isNew: false },
            { id: 'b11', code: 'B-CHINA RMF', name: 'บัวหลวงหุ้นจีนเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 8.50, ytd: -6.5, return1y: -9.5, return2y: -16.5, return3y: -12.5, return5y: -4.5, risk: 6, type: 'China Equity', isNew: false },
            { id: 'b1', code: 'BERMF', name: 'บัวหลวงตราสารทุนเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 56.78, ytd: 3.5, return1y: 7.2, return2y: 2.1, return3y: 5.4, return5y: 4.2, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 'b9', code: 'B-TOPTENRMF', name: 'บัวหลวงทศพลเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 48.20, ytd: 4.2, return1y: 8.5, return2y: 3.5, return3y: 6.2, return5y: 4.8, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 'b4', code: 'B-FLEXRMF', name: 'บัวหลวงเฟล็กซิเบิลเพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 19.88, ytd: 2.1, return1y: 4.8, return2y: 1.5, return3y: 3.2, return5y: 3.0, risk: 5, type: 'Mixed', isNew: false },
            { id: 'b10', code: 'B-GOLDRMF', name: 'บัวหลวงโกลด์เพื่อการเลี้ยงชีพ', amc: 'Bualuang', nav: 21.50, ytd: 12.5, return1y: 15.5, return2y: 10.2, return3y: 8.5, return5y: 9.2, risk: 8, type: 'Gold', isNew: false },
            { id: 'b12', code: 'B-TREASURY RMF', name: 'บัวหลวงตราสารหนี้ภาครัฐ RMF', amc: 'Bualuang', nav: 10.50, ytd: 1.9, return1y: 2.2, return2y: 1.8, return3y: 1.6, return5y: 1.4, risk: 4, type: 'Fixed Income', isNew: false },

            // TISCO
            { id: 't1', code: 'TISCOUS-RMF', name: 'ทิสโก้ ยูเอส อิควิตี้ เพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 28.45, ytd: 19.2, return1y: 26.5, return2y: 21.4, return3y: 16.8, return5y: 15.5, risk: 6, type: 'US Equity', isNew: false },
            { id: 't2', code: 'TISCOTECH-RMF', name: 'ทิสโก้ เทคโนโลยี อิควิตี้ เพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 18.20, ytd: 24.8, return1y: 31.5, return2y: 26.2, return3y: 14.5, return5y: 18.2, risk: 7, type: 'Technology', isNew: false },
            { id: 't3', code: 'TISCOCHINA-RMF', name: 'ทิสโก้ ไชน่า อิควิตี้ เพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 7.80, ytd: -4.5, return1y: -7.2, return2y: -14.2, return3y: -9.5, return5y: -3.2, risk: 6, type: 'China Equity', isNew: false },
            { id: 't4', code: 'TISCOGY-RMF', name: 'ทิสโก้ เยอรมัน อิควิตี้ เพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 11.50, ytd: 8.2, return1y: 12.5, return2y: 6.5, return3y: 5.2, return5y: 4.8, risk: 6, type: 'Europe Equity', isNew: false },
            { id: 't8', code: 'TISCOJP-RMF', name: 'ทิสโก้ เจแปน อิควิตี้ เพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 13.20, ytd: 13.5, return1y: 17.2, return2y: 10.5, return3y: 4.5, return5y: 3.2, risk: 6, type: 'Japan Equity', isNew: false },
            { id: 't9', code: 'TISCOIN-RMF', name: 'ทิสโก้ อินเดีย อิควิตี้ เพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 11.80, ytd: 9.5, return1y: 0, return2y: 0, return3y: 0, return5y: 0, risk: 7, type: 'India Equity', isNew: true },
            { id: 't5', code: 'TISCOHD-RMF', name: 'ทิสโก้ ไฮ ดิวิเดนด์ หุ้นทุนเพื่อการเลี้ยงชีพ', amc: 'TISCO', nav: 14.20, ytd: 5.2, return1y: 9.5, return2y: 4.8, return3y: 6.5, return5y: 5.2, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 't6', code: 'TISCOMS-RMF', name: 'ทิสโก้ Mid/Small Cap อิควิตี้ RMF', amc: 'TISCO', nav: 16.80, ytd: 6.5, return1y: 10.2, return2y: 5.5, return3y: 8.2, return5y: 7.5, risk: 6, type: 'Thai Equity', isNew: false },
            { id: 't10', code: 'TISCOESG-RMF', name: 'ทิสโก้ หุ้นไทยเพื่อความยั่งยืน RMF', amc: 'TISCO', nav: 10.20, ytd: 3.5, return1y: 5.2, return2y: 0, return3y: 0, return5y: 0, risk: 6, type: 'Thai Equity', isNew: true },
            { id: 't7', code: 'TISCOCLOUD-RMF', name: 'ทิสโก้ Cloud Computing RMF', amc: 'TISCO', nav: 10.05, ytd: 12.5, return1y: 0, return2y: 0, return3y: 0, return5y: 0, risk: 7, type: 'Technology', isNew: true },
        ];

        const AMC_COLORS = {
            KKP: '#6F42C1',
            Krungsri: '#F59E0B',
            Bualuang: '#1E3A8A',
            TISCO: '#CC0000',
            All: '#10B981'
        };

        function rmfDashboard() {
            return {
                funds: initialFundsData,
                selectedAmc: 'All',
                sortBy: 'return1y',
                showNewOnly: false,
                isLoading: false,
                lastUpdated: new Date().toLocaleTimeString('th-TH'),
                chartInstance: null,
                AMC_COLORS: AMC_COLORS, // Expose to template

                get filteredFunds() {
                    let data = [...this.funds]; // Clone to avoid mutating original source
                    // Filter AMC
                    if (this.selectedAmc !== 'All') {
                        data = data.filter(f => f.amc === this.selectedAmc);
                    }
                    // Filter New
                    if (this.showNewOnly) {
                        data = data.filter(f => f.isNew);
                    }

                    // Sort
                    const sortKey = (this.showNewOnly && this.sortBy === 'return1y') ? 'ytd' : this.sortBy;
                    return data.sort((a, b) => (b[sortKey] || 0) - (a[sortKey] || 0));
                },

                get stats() {
                    if (this.filteredFunds.length === 0) return { bestFund: null, avgReturn: 0, metric: 'ytd' };

                    const metric = (this.showNewOnly || this.sortBy === 'ytd') ? 'ytd' : this.sortBy;
                    const bestFund = this.filteredFunds[0]; // Already sorted

                    const totalReturn = this.filteredFunds.reduce((sum, f) => sum + (f[metric] || 0), 0);
                    const avgReturn = totalReturn / this.filteredFunds.length;

                    return { bestFund, avgReturn, metric };
                },

                getLabel(key) {
                    if (this.showNewOnly && key === 'return1y') return 'YTD (New)';
                    switch (key) {
                        case 'ytd': return 'YTD';
                        case 'return1y': return '1 Year';
                        case 'return2y': return '2 Years';
                        case 'return3y': return '3 Years';
                        case 'return5y': return '5 Years';
                        default: return 'Return';
                    }
                },

                formatVal(val) {
                    if (val === undefined || val === 0) return '-';
                    return (val > 0 ? '+' : '') + val.toFixed(2) + '%';
                },

                getColor(val) {
                    if (val === undefined || val === 0) return 'text-slate-300';
                    return val > 0 ? 'text-green-600' : 'text-red-500';
                },

                refreshData() {
                    this.isLoading = true;
                    setTimeout(() => {
                        this.funds = this.funds.map(f => ({
                            ...f,
                            ytd: f.ytd + (Math.random() - 0.5) * 0.5,
                            nav: f.nav + (Math.random() - 0.5) * 0.1
                        }));
                        this.lastUpdated = new Date().toLocaleTimeString('th-TH');
                        this.isLoading = false;
                        // Chart watcher handles update locally
                    }, 1000);
                },

                initDashboard() {
                    // Watch dependencies explicitly
                    this.$watch('selectedAmc', () => { this.$nextTick(() => this.updateChart()); });
                    this.$watch('showNewOnly', () => { this.$nextTick(() => this.updateChart()); });
                    this.$watch('sortBy', () => { this.$nextTick(() => this.updateChart()); });
                    this.$watch('funds', () => { this.$nextTick(() => this.updateChart()); });

                    // Initial render
                    this.$nextTick(() => this.renderChart());
                },

                // Chart Logic
                renderChart() {
                    const ctx = document.getElementById('performanceChart');
                    if (!ctx) return;

                    // Destroy existing if any (safety)
                    if (this.chartInstance) {
                        this.chartInstance.destroy();
                    }

                    this.chartInstance = new Chart(ctx, {
                        type: 'bar',
                        data: this.getChartData(),
                        options: {
                            indexAxis: 'y',
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    callbacks: {
                                        label: function (context) {
                                            return context.raw.toFixed(2) + '%';
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    grid: { display: true, color: '#f1f5f9' },
                                    ticks: { font: { size: 10 } }
                                },
                                y: {
                                    grid: { display: false },
                                    ticks: { font: { size: 11, weight: '500' }, color: '#475569' }
                                }
                            },
                            animation: {
                                duration: 500
                            }
                        }
                    });
                },

                updateChart() {
                    // Force a re-render to ensure axis and data are perfectly synced
                    this.renderChart();
                },

                get uniqueCategories() {
                    // Extract unique types, remove duplicates, and sort alphabetically
                    return [...new Set(this.funds.map(f => f.type))].sort();
                },

                getChartData() {
                    const top5 = this.filteredFunds.slice(0, 5);
                    const metric = (this.showNewOnly || this.sortBy === 'ytd') ? 'ytd' : this.sortBy;

                    return {
                        labels: top5.map(f => f.code),
                        datasets: [{
                            data: top5.map(f => f[metric]),
                            backgroundColor: top5.map(f => AMC_COLORS[f.amc] || '#94a3b8'),
                            borderRadius: 4,
                            barThickness: 20
                        }]
                    };
                }
            }
        }
    </script>
</body>

</html>